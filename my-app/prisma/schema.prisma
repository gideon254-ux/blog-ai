generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                String   @id @default(uuid())
  email             String   @unique
  name              String?
  password          String
  profilePictureUrl String?
  bio               String?
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  subscriptionTier  String   @default("free") @map("subscription_tier")
  apiKey            String?  @unique @map("api_key")
  totalPostsGenerated Int    @default(0) @map("total_posts_generated")
  lastLogin         DateTime? @map("last_login")

  generationJobs    GenerationJob[]
  blogPosts         BlogPost[]
  sessions          Session[]

  @@map("users")
}

model Session {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  ipAddress String?  @map("ip_address")
  userAgent String?  @map("user_agent")

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@map("sessions")
}

model GenerationJob {
  id                 String   @id @default(uuid())
  userId             String   @map("user_id")
  topic              String
  tone               String   @default("professional")
  contentType        String   @default("blog_post") @map("content_type")
  lengthPreference   String   @default("medium") @map("length_preference")
  targetAudience     String?  @map("target_audience")
  sectionsToInclude  String?  @map("sections_to_include")
  status             String   @default("queued")
  result             String?
  errorMessage       String?  @map("error_message")
  processingStartedAt DateTime? @map("processing_started_at")
  completedAt        DateTime? @map("completed_at")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  blogPost  BlogPost?

  @@index([userId])
  @@index([status])
  @@map("generation_jobs")
}

model BlogPost {
  id                String   @id @default(uuid())
  userId            String   @map("user_id")
  jobId             String?  @unique @map("job_id")
  title             String
  slug              String   @unique
  content           String
  excerpt           String?
  metaDescription   String?  @map("meta_description")
  keywords          String?
  featuredImageUrl  String?  @map("featured_image_url")
  category          String?
  authorName        String?  @map("author_name")
  status            String   @default("draft")
  publishedAt       DateTime? @map("published_at")
  scheduledAt       DateTime? @map("scheduled_at")
  viewCount         Int      @default(0) @map("view_count")
  wordCount         Int?     @map("word_count")
  readingTimeMinutes Int?    @map("reading_time_minutes")
  readabilityScore  Int?     @map("readability_score")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  generationJob   GenerationJob? @relation(fields: [jobId], references: [id])

  @@index([userId])
  @@index([slug])
  @@index([status])
  @@map("blog_posts")
}